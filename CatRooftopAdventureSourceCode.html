<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat Rooftop Adventure</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(to bottom, #1a237e, #283593, #303f9f);
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            color: white;
        }
        
        #game-container {
            position: relative;
            width: 800px;
            height: 600px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.6);
            border-radius: 10px;
        }
        
        #game-canvas {
            background: #0c1021;
            display: block;
        }
        
        #ui {
            position: absolute;
            top: 15px;
            left: 15px;
            font-size: 18px;
            z-index: 10;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 10px;
        }
        
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(12, 16, 33, 0.9);
            z-index: 20;
        }
        
        h1 {
            font-size: 36px;
            margin-bottom: 20px;
            text-align: center;
            color: #ffcc00;
            text-shadow: 2px 2px 0 #000;
        }
        
        button {
            background: #ffcc00;
            color: #1a237e;
            border: none;
            padding: 15px 30px;
            font-size: 20px;
            border-radius: 30px;
            cursor: pointer;
            margin-top: 30px;
            font-weight: bold;
            box-shadow: 0 4px 0 #d81b60;
            transition: all 0.1s;
        }
        
        button:hover {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #d81b60;
        }
        
        #instructions {
            max-width: 500px;
            text-align: center;
            margin-bottom: 30px;
            line-height: 1.6;
            font-size: 18px;
        }
        
        .controls {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }
        
        .key {
            background: #ffcc00;
            color: #1a237e;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 5px;
            font-weight: bold;
            box-shadow: 0 3px 0 #999;
        }
        
        .hidden {
            display: none;
        }
        
        #game-over {
            text-align: center;
        }
        
        #final-score {
            font-size: 32px;
            color: #ffcc00;
            margin: 15px 0;
        }
        
        #controls-info {
            margin-top: 20px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="game-canvas" width="800" height="600"></canvas>
        
        <div id="ui">
            <div>High score: <span id="score">0</span></div>
            <div>Fish: <span id="fish-count">0</span></div>
        </div>
        
        <div id="start-screen" class="screen">
            <h1>Cat Rooftop Adventure</h1>
            <div id="instructions">
                Help the cat climb as high as possible on the roofs!<br>
                Control the cat with the left/right arrows and jump with the spacebar.<br>
                Collect fish for bonus points!<br>
               The cat can jump up two platforms!
            </div>
            <div class="controls">
                <div class="key">←</div>
                <div class="key">→</div>
                <div class="key" style="width: 80px;">Space</div>
            </div>
            <button id="start-button">Start</button>
        </div>
        
        <div id="game-over-screen" class="screen hidden">
            <h1>The cat fell!</h1>
            <div>Your score:</div>
            <div id="final-score">0</div>
            <button id="restart-button">Play again</button>
        </div>
    </div>

    <script>
        // Game elements
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const fishCountElement = document.getElementById('fish-count');
        const startScreen = document.getElementById('start-screen');
        const gameOverScreen = document.getElementById('game-over-screen');
        const startButton = document.getElementById('start-button');
        const restartButton = document.getElementById('restart-button');
        const finalScoreElement = document.getElementById('final-score');

        // Game variables
        let score = 0;
        let fishCount = 0;
        let gameSpeed = 2;
        let platforms = [];
        let player;
        let fish = null;
        let gameOver = false;
        let lastTime = 0;
        let spawnTimer = 0;
        let keys = {};
        let backgroundY = 0;
        let stars = [];
        let moon = { x: 650, y: 80, radius: 40 };
        
        // Create stars for background
        for (let i = 0; i < 100; i++) {
            stars.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                size: Math.random() * 2 + 1,
                speed: Math.random() * 0.5 + 0.2
            });
        }

        // Player (cat) class
        class Player {
            constructor() {
                this.width = 40;
                this.height = 50;
                // Start on the first platform
                this.x = canvas.width / 2 - this.width / 2;
                this.y = 0; // Will be set after creating platforms
                this.velocityX = 0;
                this.velocityY = 0;
                this.jumping = false;
                this.gravity = 0.5;
                this.speed = 5;
                this.shakeTimer = 0;
                this.shakeIntensity = 0;
            }
            
            // Set position on platform
            setOnPlatform(platform) {
                this.x = platform.x + platform.width/2 - this.width/2;
                this.y = platform.y - this.height;
                this.velocityY = 0;
                this.jumping = false;
            }
            
            update() {
                // Left/right movement
                if (keys['ArrowLeft']) {
                    this.velocityX = -this.speed;
                } else if (keys['ArrowRight']) {
                    this.velocityX = this.speed;
                } else {
                    this.velocityX = 0;
                }
                
                // Jump
                if (keys[' '] && !this.jumping) {
                    this.jump();
                }
                
                // Apply gravity
                this.velocityY += this.gravity;
                this.x += this.velocityX;
                this.y += this.velocityY;
                
                // Horizontal movement boundaries
                if (this.x < 0) this.x = 0;
                if (this.x + this.width > canvas.width) this.x = canvas.width - this.width;
                
                // Check collision with platforms
                let onPlatform = false;
                for (let platform of platforms) {
                    if (this.velocityY > 0 && 
                        this.x + this.width > platform.x && 
                        this.x < platform.x + platform.width &&
                        this.y + this.height > platform.y && 
                        this.y < platform.y + platform.height) {
                        
                        // Check if cat is above the platform
                        if (this.y + this.height - this.velocityY <= platform.y) {
                            this.y = platform.y - this.height;
                            this.velocityY = 0;
                            this.jumping = false;
                            onPlatform = true;
                            
                            // Add points when cat is on platform
                            if (!platform.visited) {
                                score += 10;
                                platform.visited = true;
                                scoreElement.textContent = score;
                            }
                        }
                    }
                }
                
                // If cat is not on platform and not jumping, it's falling
                if (!onPlatform && this.velocityY === 0) {
                    this.jumping = true;
                }
                
                // Check fish collection
                if (fish && 
                    this.x + this.width > fish.x && 
                    this.x < fish.x + fish.width &&
                    this.y + this.height > fish.y && 
                    this.y < fish.y + fish.height) {
                    
                    score += 50;
                    fishCount++;
                    scoreElement.textContent = score;
                    fishCountElement.textContent = fishCount;
                    playSound('fish');
                    fish = null;
                }
                
                // Check if cat fell off the bottom
                if (this.y > canvas.height) {
                    gameOver = true;
                    playSound('fall');
                    finalScoreElement.textContent = score;
                    gameOverScreen.classList.remove('hidden');
                }
                
                // Update cat shake effect
                if (this.shakeTimer > 0) {
                    this.shakeTimer--;
                }
            }
            
            jump() {
                if (!this.jumping) {
                    this.velocityY = -16; // Increased jump force
                    this.jumping = true;
                    this.shakeTimer = 10;
                    this.shakeIntensity = 2;
                    playSound('jump');
                }
            }
            
            draw() {
                // Calculate shake offset
                let shakeX = 0;
                let shakeY = 0;
                if (this.shakeTimer > 0) {
                    shakeX = (Math.random() - 0.5) * this.shakeIntensity;
                    shakeY = (Math.random() - 0.5) * this.shakeIntensity;
                }
                
                // Draw cat body
                ctx.fillStyle = '#000';
                ctx.fillRect(this.x + shakeX, this.y + shakeY, this.width, this.height);
                
                // Ears
                ctx.fillStyle = '#000';
                ctx.beginPath();
                ctx.moveTo(this.x - 2 + shakeX, this.y + 5 + shakeY);
                ctx.lineTo(this.x + 5 + shakeX, this.y - 5 + shakeY);
                ctx.lineTo(this.x + 12 + shakeX, this.y + 5 + shakeY);
                ctx.fill();
                
                ctx.beginPath();
                ctx.moveTo(this.x + this.width - 5 + shakeX, this.y - 5 + shakeY);
                ctx.lineTo(this.x + this.width + 2 + shakeX, this.y + 5 + shakeY);
                ctx.lineTo(this.x + this.width - 12 + shakeX, this.y + 5 + shakeY);
                ctx.fill();
                
                // Eyes
                ctx.fillStyle = '#ffcc00';
                ctx.beginPath();
                ctx.arc(this.x + 12 + shakeX, this.y + 18 + shakeY, 5, 0, Math.PI * 2);
                ctx.arc(this.x + 28 + shakeX, this.y + 18 + shakeY, 5, 0, Math.PI * 2);
                ctx.fill();
                
                // Pupils (follow movement)
                ctx.fillStyle = '#000';
                let pupilOffsetX = this.velocityX * 0.5;
                if (pupilOffsetX > 3) pupilOffsetX = 3;
                if (pupilOffsetX < -3) pupilOffsetX = -3;
                
                ctx.beginPath();
                ctx.arc(this.x + 12 + pupilOffsetX + shakeX, this.y + 18 + shakeY, 2, 0, Math.PI * 2);
                ctx.arc(this.x + 28 + pupilOffsetX + shakeX, this.y + 18 + shakeY, 2, 0, Math.PI * 2);
                ctx.fill();
                
                // Nose
                ctx.fillStyle = '#ff3366';
                ctx.beginPath();
                ctx.arc(this.x + 20 + shakeX, this.y + 25 + shakeY, 4, 0, Math.PI * 2);
                ctx.fill();
                
                // Whiskers
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(this.x + 20 + shakeX, this.y + 25 + shakeY);
                ctx.lineTo(this.x + 5 + shakeX, this.y + 22 + shakeY);
                ctx.moveTo(this.x + 20 + shakeX, this.y + 25 + shakeY);
                ctx.lineTo(this.x + 5 + shakeX, this.y + 28 + shakeY);
                ctx.moveTo(this.x + 20 + shakeX, this.y + 25 + shakeY);
                ctx.lineTo(this.x + 35 + shakeX, this.y + 22 + shakeY);
                ctx.moveTo(this.x + 20 + shakeX, this.y + 25 + shakeY);
                ctx.lineTo(this.x + 35 + shakeX, this.y + 28 + shakeY);
                ctx.stroke();
                
                // Tail (moves based on velocity)
                let tailCurve = Math.sin(Date.now() / 120) * 5 * (this.velocityX / this.speed);
                ctx.beginPath();
                ctx.moveTo(this.x + this.width + shakeX, this.y + this.height - 10 + shakeY);
                ctx.quadraticCurveTo(
                    this.x + this.width + 20 + tailCurve + shakeX, 
                    this.y + this.height - 20 + shakeY,
                    this.x + this.width + 10 + shakeX, 
                    this.y + this.height - 30 + shakeY
                );
                ctx.lineWidth = 5;
                ctx.strokeStyle = '#000';
                ctx.stroke();
            }
        }

        // Platform (rooftop) class
        class Platform {
            constructor(x, y, width) {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = 20;
                this.visited = false;
            }
            
            update() {
                this.y += gameSpeed;
                
                // Remove platform if it goes off screen
                if (this.y > canvas.height) {
                    return false;
                }
                return true;
            }
            
            draw() {
                // Draw roof
                ctx.fillStyle = this.visited ? '#6d4c41' : '#795548';
                ctx.fillRect(this.x, this.y, this.width, this.height);
                
                // Roof texture
                ctx.fillStyle = '#5d4037';
                for (let i = 0; i < this.width; i += 15) {
                    ctx.fillRect(this.x + i, this.y, 7, this.height);
                }
            }
        }

        // Fish class
        class Fish {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.width = 25;
                this.height = 12;
                this.wiggle = 0;
            }
            
            update() {
                this.y += gameSpeed;
                this.wiggle = Math.sin(Date.now() / 200) * 3;
                
                // Remove fish if it goes off screen
                if (this.y > canvas.height) {
                    return false;
                }
                return true;
            }
            
            draw() {
                // Draw fish body
                ctx.fillStyle = '#ff5252';
                ctx.beginPath();
                ctx.ellipse(this.x + this.width/2, this.y + this.height/2 + this.wiggle, this.width/2, this.height/2, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // Tail
                ctx.beginPath();
                ctx.moveTo(this.x - 3, this.y + this.height/2 + this.wiggle);
                ctx.lineTo(this.x + 7, this.y + this.wiggle);
                ctx.lineTo(this.x + 7, this.y + this.height + this.wiggle);
                ctx.closePath();
                ctx.fill();
                
                // Eye
                ctx.fillStyle = '#000';
                ctx.beginPath();
                ctx.arc(this.x + 18, this.y + 5 + this.wiggle, 2, 0, Math.PI * 2);
                ctx.fill();
                
                // Fish shine effect
                ctx.fillStyle = '#fff';
                ctx.beginPath();
                ctx.arc(this.x + 22, this.y + 4 + this.wiggle, 1.5, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // Sound effects
        const sounds = {
            jump: () => {
                const osc = new OscillatorNode(context, { frequency: 523.25 });
                const gain = new GainNode(context, { gain: 0.2 });
                osc.connect(gain).connect(context.destination);
                osc.start();
                osc.stop(context.currentTime + 0.1);
            },
            fish: () => {
                const osc = new OscillatorNode(context, { frequency: 659.25 });
                const gain = new GainNode(context, { gain: 0.2 });
                osc.connect(gain).connect(context.destination);
                osc.start();
                osc.stop(context.currentTime + 0.1);
                
                const osc2 = new OscillatorNode(context, { frequency: 783.99 });
                const gain2 = new GainNode(context, { gain: 0.2 });
                osc2.connect(gain2).connect(context.destination);
                osc2.start(context.currentTime + 0.1);
                osc2.stop(context.currentTime + 0.2);
            },
            fall: () => {
                const osc = new OscillatorNode(context, { frequency: 220 });
                const gain = new GainNode(context, { gain: 0.3 });
                osc.connect(gain).connect(context.destination);
                osc.start();
                osc.frequency.exponentialRampToValueAtTime(110, context.currentTime + 0.5);
                gain.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 0.5);
                osc.stop(context.currentTime + 0.5);
            }
        };

        // Audio context
        const context = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(name) {
            if (sounds[name]) {
                sounds[name]();
            }
        }

        // Initialize game
        function init() {
            score = 0;
            fishCount = 0;
            gameSpeed = 2;
            platforms = [];
            player = new Player();
            fish = null;
            gameOver = false;
            spawnTimer = 0;
            
            // Create initial platforms
            for (let i = 0; i < 8; i++) {
                platforms.push(createPlatform(canvas.height - i * 80));
            }
            
            // Place cat on one of the platforms
            const startPlatform = platforms[platforms.length - 2]; // Second platform from top
            player.setOnPlatform(startPlatform);
            
            scoreElement.textContent = score;
            fishCountElement.textContent = fishCount;
            
            // Reset keys
            keys = {};
        }

        // Create platform
        function createPlatform(y) {
            const width = Math.random() * 100 + 80;
            const x = Math.random() * (canvas.width - width);
            return new Platform(x, y, width);
        }

        // Create fish (only on platforms that are already on screen)
        function createFish() {
            // Select only platforms in the upper part of the screen
            const visiblePlatforms = platforms.filter(p => p.y < canvas.height * 0.7);
            if (visiblePlatforms.length === 0) return null;
            
            const platform = visiblePlatforms[Math.floor(Math.random() * visiblePlatforms.length)];
            const x = platform.x + Math.random() * (platform.width - 25);
            const y = platform.y - 30;
            return new Fish(x, y);
        }

        // Game loop
        function gameLoop(timestamp) {
            if (!lastTime) lastTime = timestamp;
            const deltaTime = timestamp - lastTime;
            lastTime = timestamp;
            
            if (!gameOver) {
                // Clear canvas
                ctx.fillStyle = '#0c1021';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Draw moon
                ctx.fillStyle = '#fff';
                ctx.beginPath();
                ctx.arc(moon.x, moon.y, moon.radius, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw moon craters
                ctx.fillStyle = '#e0e0e0';
                ctx.beginPath();
                ctx.arc(moon.x - 15, moon.y - 10, moon.radius/4, 0, Math.PI * 2);
                ctx.arc(moon.x + 20, moon.y + 5, moon.radius/5, 0, Math.PI * 2);
                ctx.arc(moon.x + 5, moon.y + 15, moon.radius/3, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw starry background
                ctx.fillStyle = '#ffffff';
                stars.forEach(star => {
                    star.y += star.speed;
                    if (star.y > canvas.height) {
                        star.y = 0;
                        star.x = Math.random() * canvas.width;
                    }
                    ctx.beginPath();
                    ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                    ctx.fill();
                });
                
                // Update and draw platforms
                for (let i = platforms.length - 1; i >= 0; i--) {
                    platforms[i].draw();
                    if (!platforms[i].update()) {
                        platforms.splice(i, 1);
                        // Add new platform at the top
                        platforms.push(createPlatform(-20));
                    }
                }
                
                // Update and draw fish
                if (fish) {
                    fish.draw();
                    if (!fish.update()) {
                        fish = null;
                    }
                } else {
                    // Spawn fish randomly
                    spawnTimer += deltaTime;
                    if (spawnTimer > 2000) { // Every 2 seconds
                        if (Math.random() < 0.3) { // 30% chance to spawn fish
                            fish = createFish();
                        }
                        spawnTimer = 0;
                    }
                }
                
                // Update and draw player
                player.update();
                player.draw();
                
                // Increase difficulty over time
                if (score > 0 && score % 200 === 0) {
                    gameSpeed = 2 + Math.floor(score / 200) * 0.2;
                }
                
                requestAnimationFrame(gameLoop);
            }
        }

        // Event handlers
        startButton.addEventListener('click', () => {
            startScreen.classList.add('hidden');
            init();
            lastTime = 0;
            requestAnimationFrame(gameLoop);
        });

        restartButton.addEventListener('click', () => {
            gameOverScreen.classList.add('hidden');
            init();
            lastTime = 0;
            requestAnimationFrame(gameLoop);
        });

        // Key press handling
        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            // Prevent page scrolling when space is pressed
            if (e.key === ' ') {
                e.preventDefault();
            }
        });

        window.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        // Start game
        window.addEventListener('load', () => {
            // Pre-initialization
            ctx.fillStyle = '#0c1021';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#ffffff';
            ctx.font = '24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Загрузка...', canvas.width / 2, canvas.height / 2);
        });
    </script>
</body>
</html>